<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>訂房計價 + 月曆庫存（東海店過年方案）</title>
  <style>
    /* ===== Morandi 調色 ===== */
    :root{
      --bg:#f2efe9; --card:#ffffff; --text:#3f3a3a; --muted:#7d7671;
      --accent:#6b8e7a; --accent-strong:#4f7a66;
      --btn:#e7e3dd; --btn2:#d6d1ca; --danger:#b76e79;
      --input-bg:#f6f3ee; --input-border:#d5cfc8; --shadow:0 8px 18px rgba(0,0,0,.06);
      --cny:#ffe6b3; /* 過年底色提示 */
    }
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto,Arial;}
    .container{max-width:980px;margin:0 auto;padding:22px;}
    h1{font-size:22px;margin:0 0 16px;font-weight:800;color:#3a3734}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:var(--shadow);border:1px solid #eee7df;}
    .label{font-size:14px;color:var(--muted);margin-bottom:6px}
    .title{font-weight:700}
    .hint{color:var(--muted);font-size:14px}
    .accent{color:var(--accent-strong);font-weight:700}
    .money{font-weight:800}
    input,select,button{font-size:16px}
    input[type="date"],select{
      background:var(--input-bg);color:var(--text);border:1px solid var(--input-border);border-radius:10px;
      padding:8px 10px;min-width:160px;outline:none;
    }
    .btn{background:var(--btn);color:var(--text);border:1px solid var(--input-border);border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn:hover{filter:brightness(0.98)} .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn2{background:var(--btn2);border:1px solid var(--input-border)}
    .pill{display:inline-block;background:var(--input-bg);border:1px solid var(--input-border);border-radius:999px;padding:6px 10px;font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
    .right{text-align:right}
    .radio{display:flex;gap:12px;align-items:center;border:1px solid var(--input-border);background:var(--input-bg);border-radius:12px;padding:10px 12px;cursor:pointer}
    .radio input{accent-color:var(--accent);transform:scale(1.1)}
    .flex-between{display:flex;justify-content:space-between;align-items:center}

    /* Tabs */
    .tabs{display:flex;gap:8px;margin:8px 0 16px;}
    .tab{background:var(--btn);border:1px solid var(--input-border);padding:10px 14px;border-radius:999px;cursor:pointer}
    .tab.active{background:var(--accent);border-color:transparent;color:#fff;font-weight:700}
    .page{display:none}
    .page.active{display:block}

    /* 摘要底部 3 欄（訂金 / 尾款 / 總價） */
    .summary-bottom{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;padding-top:12px;border-top:1px dashed var(--input-border);}
    .summary-box{background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;padding:12px;text-align:center;}
    .summary-box .label{color:var(--muted);font-size:14px;margin-bottom:4px;}
    .summary-box .value{font-weight:800;font-size:18px;}

    /* 月曆 */
    .calendar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
    .calendar-header .month-title{font-weight:800;font-size:18px}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
    .dow{font-weight:700;text-align:center;color:var(--muted)}
    .day{background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;padding:8px;min-height:84px;display:flex;flex-direction:column;justify-content:space-between}
    .day .dnum{font-weight:700}
    .day .remain{font-size:14px}
    .day .ops{display:flex;gap:6px;justify-content:flex-end}
    .day .ops button{padding:4px 8px;border-radius:8px;border:1px solid var(--input-border);background:var(--btn);cursor:pointer}
    .day.cny{background:var(--cny)}
    .legend{display:flex;gap:12px;align-items:center}
    .legend .box{width:18px;height:14px;border:1px solid var(--input-border);border-radius:4px;background:var(--cny)}

    /* 手機優化 */
    @media (max-width: 420px){
      .container{padding:14px;}
      .grid{grid-template-columns:1fr;}
      .row{gap:8px}
      input[type="date"],select{min-width:0;width:100%}
      .summary-bottom{grid-template-columns:1fr;}
      .day{min-height:76px}
      .day .ops button{padding:3px 6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>訂房計價 + 月曆庫存（僅東海標準房含過年方案）</h1>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" id="tab-calc">① 計價</button>
      <button class="tab" id="tab-cal">② 月曆庫存</button>
    </div>

    <!-- Page 1: 計價 -->
    <div class="page active" id="page-calc">
      <!-- 日期 -->
      <div class="card">
        <div class="row">
          <div>
            <div class="label">入住日（check-in）</div>
            <input id="checkIn" type="date">
          </div>
          <div>
            <div class="label">退房日（check-out，當天不入住）</div>
            <input id="checkOut" type="date">
          </div>
          <div style="align-self:end">
            <button id="btnTodayToTomorrow" class="btn">今天→明天</button>
          </div>
        </div>
        <div id="dateInfo" class="hint" style="margin-top:10px"></div>
      </div>

      <!-- 房型單選 -->
      <div class="card">
        <div class="label">選擇房型（擇一）</div>
        <div id="roomList" class="grid"></div>
      </div>

      <!-- 入住貓咪數 -->
      <div class="card" id="catsCard">
        <div class="flex-between">
          <div>
            <div class="title">入住貓咪數</div>
            <div id="catsHint" class="hint">請先選房型</div>
          </div>
          <div>
            <button id="minusCats" class="btn2">－</button>
            <span id="catsText" class="pill" style="margin:0 8px">1 隻</span>
            <button id="plusCats" class="btn">＋</button>
          </div>
        </div>
      </div>

      <!-- 預訂摘要 -->
      <div class="card">
        <div class="title" style="margin-bottom:8px">預訂摘要</div>
        <div id="summary"></div>
      </div>
    </div>

    <!-- Page 2: 月曆庫存 -->
    <div class="page" id="page-cal">
      <div class="card">
        <div class="row" style="align-items:flex-end">
          <div>
            <div class="label">房型（每日期滿 8 間）</div>
            <select id="invRoom">
              <!-- 由 JS 填入與 Page1 相同房型 -->
            </select>
          </div>
          <div class="legend" style="margin-left:auto">
            <span class="box"></span><span class="hint">過年區間（僅東海標準房特別價）</span>
          </div>
        </div>

        <div class="calendar-header">
          <button id="prevMonth" class="btn2">← 上個月</button>
          <div class="month-title" id="monthTitle"></div>
          <button id="nextMonth" class="btn">下個月 →</button>
        </div>

        <div class="calendar-grid" id="calendarGrid">
          <!-- 7 x 6 -->
        </div>
        <div class="hint" style="margin-top:8px">
          點選每一天右下角「＋ / －」變更已預訂數（最多 8）。本功能僅在此裝置本機儲存（localStorage），若要多人共用請串接雲端資料庫。
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ------------------ 設定（與你的規則一致） ------------------ */
    const ROOMS = [
      { key:"jazz", name:"爵士房",        base:760,  maxCats:2 },
      { key:"upgrade", name:"爵士升等房",  base:1100, maxCats:3 },
      { key:"first", name:"頭等房",        base:1400, maxCats:4 },
      { key:"little_president", name:"小總統房", base:2500, maxCats:6 },
      { key:"president", name:"大總統房",  base:3200, maxCats:7 },
      { key:"stand", name:"東海標準房",    base:800,  maxCats:2 }
    ];

    // 一般方案：單貓/多貓（兩隻以上）
    function pricesFor(key){
      switch(key){
        case "jazz":              return { single:760,  multi:950 };
        case "upgrade":           return { single:880,  multi:1100 };   // 1100*0.8
        case "first":             return { single:1120, multi:1400 };   // 1400*0.8
        case "little_president":  return { single:2000, multi:2500 };   // 2500*0.8
        case "president":         return { single:2560, multi:3200 };   // 3200*0.8
        case "stand":             return { single:800,  multi:1000 };
        default:                  return { single:0,    multi:0 };
      }
    }

    // 長住 tiers（僅完全不在過年期間時才可能套用）
    const Tier = { N90:90, N30:30, N13:13, N06:6 };
    function currentTier(n){ if(n>=90) return {code:"N90",label:"90 晚起"};
      if(n>=30) return {code:"N30",label:"30 晚起"}; if(n>=13) return {code:"N13",label:"13 晚起"};
      if(n>=6) return {code:"N06",label:"6 晚起"}; return null; }

    // 長住固定單價（單貓 / 多貓）
    const FIXED_SINGLE = {
      jazz:{N06:680,N13:650,N30:550,N90:500}, upgrade:{N06:790,N13:750,N30:650,N90:570},
      first:{N06:1010,N13:960,N30:820,N90:730}, little_president:{N06:1800,N13:1700,N30:1600,N90:1400},
      president:{N06:2300,N13:2150,N30:1850,N90:1650}, stand:{N06:720,N13:680,N30:570,N90:520}
    };
    const FIXED_MULTI = {
      jazz:{N06:860,N13:810,N30:680,N90:620}, upgrade:{N06:990,N13:940,N30:800,N90:720},
      first:{N06:1260,N13:1200,N30:1010,N90:910}, little_president:{N06:2250,N13:2100,N30:1800,N90:1600},
      president:{N06:2880,N13:2700,N30:2300,N90:2100}, stand:{N06:900,N13:850,N30:710,N90:650}
    };

    // —— 過年（僅東海標準房）——
    const THIS_YEAR = new Date().getFullYear(); // 以今年計
    const CNY_START = new Date(THIS_YEAR, 1, 14);    // 2/14
    const CNY_END_EXCL = new Date(THIS_YEAR, 1, 23); // 2/23 不含
    const CNY_PPN = 1250;          // 單/多貓同價
    const CNY_PACK_4N = 6888;      // 5天4夜
    const CNY_PACK_8N = 9888;      // 9天8夜

    // 訂金 30%（四捨五入）：(total * 3 + 5) / 10
    const calcDeposit = t => (t<=0)?0:Math.floor((t*3+5)/10);

    /* ------------------ 共用小工具 ------------------ */
    function fmtDate(d){const y=d.getFullYear(),m=('0'+(d.getMonth()+1)).slice(-2),dd=('0'+d.getDate()).slice(-2); return `${y}-${m}-${dd}`;}
    function parseDate(s){const [y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d);}
    function diffNights(a,b){return Math.max(0,Math.round((b-a)/(1000*60*60*24)));}

    function nightlyPriceNonCNY(roomKey, cats, nights){
      const tier=currentTier(nights);
      if(tier){
        const table=(cats>=2)?FIXED_MULTI:FIXED_SINGLE;
        const price=table?.[roomKey]?.[tier.code] ?? 0;
        return { nightly:price, tag:`長住 ${tier.label}` };
      }else{
        const p=pricesFor(roomKey);
        return { nightly:(cats>=2)?p.multi:p.single, tag:'一般價' };
      }
    }

    function clampToRange(d, start, endExcl){ return new Date(Math.max(start, Math.min(d, endExcl))); }
    function splitCNYNights(ci, co){
      const overlap = (ci < CNY_END_EXCL) && (co > CNY_START);
      let nightsCny=0, nightsNon=0;
      if(overlap){
        const sc = (ci < CNY_START) ? CNY_START : ci;
        const ec = (co > CNY_END_EXCL) ? CNY_END_EXCL : co;
        if(ec > sc){
          nightsCny = diffNights(sc, ec);
          nightsNon = diffNights(ci, co) - nightsCny;
        }else{
          nightsNon = diffNights(ci, co);
        }
      }else{
        nightsNon = diffNights(ci, co);
      }
      return { nightsCny, nightsNon };
    }

    function computeTotal(ciStr, coStr, roomKey, cats){
      const ci=parseDate(ciStr), co=parseDate(coStr);
      const nightsAll=diffNights(ci,co);
      if(nightsAll<=0 || !roomKey) return { nightly:0, tag:null, total:0, detail:[] };

      const isStand=(roomKey==='stand');
      const fullyInCNY = (ci>=CNY_START) && (co<=CNY_END_EXCL);
      const fullyOutCNY = (co<=CNY_START) || (ci>=CNY_END_EXCL);

      let detail=[], nightly=null, tag=null, total=0;

      if(fullyInCNY){
        if(isStand){
          if(nightsAll===4){ total=CNY_PACK_4N; nightly=Math.round(total/nightsAll); tag='過年套裝：5天4夜（東海標準房）';
            detail.push(`過年套裝 4 夜：NT$ ${total}（等效 NT$ ${nightly}/晚）`);
          }else if(nightsAll===8){ total=CNY_PACK_8N; nightly=Math.round(total/nightsAll); tag='過年套裝：9天8夜（東海標準房）';
            detail.push(`過年套裝 8 夜：NT$ ${total}（等效 NT$ ${nightly}/晚）`);
          }else{ nightly=CNY_PPN; total=nightsAll*CNY_PPN; tag='過年單晚價（東海標準房）';
            detail.push(`過年 ${nightsAll} 夜 × NT$ ${CNY_PPN} = NT$ ${total}`); }
        }else{
          const p=pricesFor(roomKey), ppn=(cats>=2)?p.multi:p.single;
          nightly=ppn; tag='一般價（過年期間不計長住）'; total=nightsAll*ppn;
          detail.push(`${nightsAll} 夜 × NT$ ${ppn} = NT$ ${total}`);
        }
      }
      else if(fullyOutCNY){
        const res=nightlyPriceNonCNY(roomKey,cats,nightsAll);
        nightly=res.nightly; tag=res.tag; total=nightsAll*nightly;
        detail.push(`${res.tag}：${nightsAll} 夜 × NT$ ${nightly} = NT$ ${total}`);
      }
      else{
        const {nightsCny,nightsNon}=splitCNYNights(ci,co);
        let chargeNon=0, chargeCny=0;

        if(nightsNon>0){
          const nonRes=nightlyPriceNonCNY(roomKey,cats,nightsNon);
          chargeNon=nightsNon*nonRes.nightly;
          detail.push(`非過年 ${nightsNon} 夜 × NT$ ${nonRes.nightly}（${nonRes.tag}） = NT$ ${chargeNon}`);
        }
        if(nightsCny>0){
          if(isStand){
            chargeCny=nightsCny*CNY_PPN;
            detail.push(`過年（東海標準房）${nightsCny} 夜 × NT$ ${CNY_PPN} = NT$ ${chargeCny}`);
          }else{
            const p=pricesFor(roomKey), ppn=(cats>=2)?p.multi:p.single;
            chargeCny=nightsCny*ppn;
            detail.push(`過年（一般價）${nightsCny} 夜 × NT$ ${ppn} = NT$ ${chargeCny}`);
          }
        }
        total=chargeNon+chargeCny; nightly=null; tag='跨過年分段計價';
      }

      return { nightly, tag, total, detail };
    }

    /* ------------------ Page 1：計價 ------------------ */
    const elCheckIn  = document.getElementById('checkIn');
    const elCheckOut = document.getElementById('checkOut');
    const elBtnToday = document.getElementById('btnTodayToTomorrow');
    const elDateInfo = document.getElementById('dateInfo');
    const elRoomList = document.getElementById('roomList');
    const elCatsHint = document.getElementById('catsHint');
    const elMinusCats= document.getElementById('minusCats');
    const elPlusCats = document.getElementById('plusCats');
    const elCatsText = document.getElementById('catsText');
    const elSummary  = document.getElementById('summary');

    let selectedKey = null;
    let cats = 1;

    // init 日期：今天→明天
    (function initDates(){
      const today=new Date(); const tomorrow=new Date(today); tomorrow.setDate(tomorrow.getDate()+1);
      elCheckIn.value=fmtDate(today); elCheckOut.value=fmtDate(tomorrow);
    })();

    function getNights(){ return diffNights(parseDate(elCheckIn.value), parseDate(elCheckOut.value)); }

    function clampCats(){
      const room = ROOMS.find(r=>r.key===selectedKey);
      const maxCats = room ? room.maxCats : 1;
      cats = Math.min(Math.max(1, cats), maxCats);
      elCatsText.textContent = `${cats} 隻`;
      elMinusCats.disabled = (cats<=1);
      elPlusCats.disabled  = !room || (cats>=maxCats);
      elCatsHint.textContent = room ? `兩隻以上一律多貓價；本房型最多 ${maxCats} 隻` : '請先選房型';
    }

    function renderRooms(){
      elRoomList.innerHTML = '';
      ROOMS.forEach(room=>{
        const p = pricesFor(room.key);
        const id = `room_${room.key}`;
        const div = document.createElement('label');
        div.className = 'radio';
        div.innerHTML = `
          <input type="radio" name="room" id="${id}">
          <div>
            <div class="title">${room.name}</div>
            <div class="hint">一般單晚（單貓／多貓）：NT$ ${p.single}／${p.multi}（上限 ${room.maxCats} 隻）</div>
          </div>
        `;
        div.querySelector('input').checked = (selectedKey === room.key);
        div.addEventListener('change', ()=>{ selectedKey = room.key; clampCats(); recalcCalc(); });
        elRoomList.appendChild(div);
      });
    }

    function recalcCalc(){
      const ci = elCheckIn.value, co = elCheckOut.value;
      const nights = getNights(), days=nights+1;
      elDateInfo.textContent = `入住：${ci}　退房：${co}　→ 共 ${days} 天 ${nights} 夜（夜數計價）`;

      const room = ROOMS.find(r=>r.key===selectedKey);
      const roomPrices = room ? pricesFor(room.key) : null;

      const { nightly, tag, total, detail } = computeTotal(ci, co, selectedKey, cats);
      const deposit = calcDeposit(total);
      const balance = Math.max(0, total - deposit);

      const detailHtml = detail.length
        ? `<ul class="hint" style="margin:8px 0 0 18px">${detail.map(d=>`<li>${d}</li>`).join('')}</ul>`
        : '';

      const priceLabel = nightly ? `NT$ ${nightly}` : '—';

      elSummary.innerHTML = `
        <div class="grid">
          <div><div class="label">房型</div><div>${room ? room.name : '尚未選擇'}</div></div>
          <div><div class="label">一般單晚（單貓／多貓）</div><div>${roomPrices ? `NT$ ${roomPrices.single}／${roomPrices.multi}` : '—'}</div></div>
          <div><div class="label">貓咪</div><div>${cats} 隻（兩隻以上用多貓價）</div></div>
          <div><div class="label">夜數</div><div>${nights} 夜</div></div>
          <div><div class="label">計價單晚</div><div class="accent">${priceLabel} ${tag?`<span class="hint"> ${tag}</span>`:''}</div></div>
        </div>
        ${detailHtml}
        <div class="summary-bottom">
          <div class="summary-box"><div class="label">訂金 30%（四捨五入）</div><div class="value">NT$ ${deposit}</div></div>
          <div class="summary-box"><div class="label">尾款</div><div class="value">NT$ ${balance}</div></div>
          <div class="summary-box"><div class="label">總價</div><div class="value">NT$ ${total}</div></div>
        </div>`;
    }

    elCheckIn.addEventListener('change', ()=>{
      const ci=parseDate(elCheckIn.value), co=parseDate(elCheckOut.value);
      if(co<=ci){const t=new Date(ci); t.setDate(ci.getDate()+1); elCheckOut.value=fmtDate(t);}
      recalcCalc();
    });
    elCheckOut.addEventListener('change', ()=>{
      const ci=parseDate(elCheckIn.value), co=parseDate(elCheckOut.value);
      if(co<=ci){const t=new Date(ci); t.setDate(ci.getDate()+1); elCheckOut.value=fmtDate(t);}
      recalcCalc();
    });
    elBtnToday.addEventListener('click', ()=>{
      const today=new Date(), tom=new Date(); tom.setDate(today.getDate()+1);
      elCheckIn.value=fmtDate(today); elCheckOut.value=fmtDate(tom); recalcCalc();
    });
    elMinusCats.addEventListener('click', ()=>{ cats=Math.max(1,cats-1); clampCats(); recalcCalc(); });
    elPlusCats.addEventListener('click',  ()=>{ cats+=1; clampCats(); recalcCalc(); });

    // 初始 Page1
    renderRooms(); clampCats(); recalcCalc();

    /* ------------------ Page 2：月曆庫存（本機儲存） ------------------ */
    const elInvRoom = document.getElementById('invRoom');
    const elMonthTitle = document.getElementById('monthTitle');
    const elCalGrid = document.getElementById('calendarGrid');
    const elPrev = document.getElementById('prevMonth');
    const elNext = document.getElementById('nextMonth');

    // 初始化房型選單
    ROOMS.forEach(r=>{
      const opt=document.createElement('option');
      opt.value=r.key; opt.textContent=r.name;
      elInvRoom.appendChild(opt);
    });
    elInvRoom.value='stand'; // 預設看東海標準房

    // 月份狀態
    let calYear = new Date().getFullYear();
    let calMonth = new Date().getMonth(); // 0~11

    // localStorage key：inventory-{roomKey}
    function invKey(roomKey){ return `inventory-${roomKey}`; }
    function loadInv(roomKey){
      try{ return JSON.parse(localStorage.getItem(invKey(roomKey))||'{}'); }catch{ return {}; }
    }
    function saveInv(roomKey, data){
      localStorage.setItem(invKey(roomKey), JSON.stringify(data));
    }
    function setBooked(roomKey, y,m,d, count){
      const data=loadInv(roomKey);
      const key=`${y}-${('0'+(m+1)).slice(-2)}-${('0'+d).slice(-2)}`;
      data[key]=Math.max(0, Math.min(8, count|0));
      saveInv(roomKey, data);
    }
    function getBooked(roomKey, y,m,d){
      const data=loadInv(roomKey);
      const key=`${y}-${('0'+(m+1)).slice(-2)}-${('0'+d).slice(-2)}`;
      return data[key]||0;
    }

    function isCNYDate(date){
      return (date >= CNY_START && date < CNY_END_EXCL);
    }

    function renderCalendar(){
      elCalGrid.innerHTML='';
      const first = new Date(calYear, calMonth, 1);
      const firstDow = first.getDay(); // 0=Sun
      const daysInMonth = new Date(calYear, calMonth+1, 0).getDate();

      elMonthTitle.textContent = `${calYear}年 ${calMonth+1}月`;

      // DOW header
      const dows = ['日','一','二','三','四','五','六'];
      dows.forEach(w=>{
        const h=document.createElement('div');
        h.className='dow'; h.textContent=w;
        elCalGrid.appendChild(h);
      });

      // blanks before first day
      for(let i=0;i<firstDow;i++){
        const b=document.createElement('div'); b.className='day'; b.style.visibility='hidden';
        elCalGrid.appendChild(b);
      }

      for(let d=1; d<=daysInMonth; d++){
        const cellDate = new Date(calYear, calMonth, d);
        const day = document.createElement('div');
        day.className = 'day';
        if(isCNYDate(cellDate) && elInvRoom.value==='stand') day.classList.add('cny');

        const booked = getBooked(elInvRoom.value, calYear, calMonth, d);
        const remain = 8 - booked;

        day.innerHTML = `
          <div class="dnum">${d}</div>
          <div class="remain">剩 ${remain}/8</div>
          <div class="ops">
            <button class="minus">－</button>
            <button class="plus">＋</button>
          </div>
        `;

        day.querySelector('.minus').addEventListener('click', ()=>{
          const cur = getBooked(elInvRoom.value, calYear, calMonth, d);
          setBooked(elInvRoom.value, calYear, calMonth, d, Math.max(0, cur-1));
          renderCalendar();
        });
        day.querySelector('.plus').addEventListener('click', ()=>{
          const cur = getBooked(elInvRoom.value, calYear, calMonth, d);
          setBooked(elInvRoom.value, calYear, calMonth, d, Math.min(8, cur+1));
          renderCalendar();
        });

        elCalGrid.appendChild(day);
      }
    }

    elInvRoom.addEventListener('change', renderCalendar);
    elPrev.addEventListener('click', ()=>{
      calMonth--; if(calMonth<0){calMonth=11; calYear--;} renderCalendar();
    });
    elNext.addEventListener('click', ()=>{
      calMonth++; if(calMonth>11){calMonth=0; calYear++;} renderCalendar();
    });

    // 初始 Page2
    renderCalendar();

    /* ------------------ Tabs ------------------ */
    const tabCalc = document.getElementById('tab-calc');
    const tabCal  = document.getElementById('tab-cal');
    const pageCalc= document.getElementById('page-calc');
    const pageCal = document.getElementById('page-cal');

    function activate(tab){
      if(tab==='calc'){
        tabCalc.classList.add('active'); tabCal.classList.remove('active');
        pageCalc.classList.add('active'); pageCal.classList.remove('active');
      }else{
        tabCal.classList.add('active'); tabCalc.classList.remove('active');
        pageCal.classList.add('active'); pageCalc.classList.remove('active');
        renderCalendar();
      }
    }
    tabCalc.addEventListener('click', ()=>activate('calc'));
    tabCal .addEventListener('click', ()=>activate('cal'));
  </script>
</body>
</html>
