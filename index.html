<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>訂房計價 Demo - 完整資訊版</title>
  <style>
    :root{
      --bg:#f2efe9; --card:#ffffff; --text:#3f3a3a; --muted:#7d7671;
      --accent:#6b8e7a; --accent-strong:#4f7a66; --btn:#e7e3dd; --btn2:#d6d1ca; --danger:#b76e79;
      --input-bg:#f6f3ee; --input-border:#d5cfc8; --shadow:0 8px 18px rgba(0,0,0,.06);
    }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto,Arial}
    .container{max-width:980px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:0 0 16px;font-weight:800;color:#3a3734}
    .card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:var(--shadow);border:1px solid #eee7df}
    .label{font-size:13px;color:var(--muted);margin-bottom:6px}
    .title{font-weight:700; font-size: 16px; margin-bottom: 8px; color: var(--accent-strong);}
    .hint{color:var(--muted);font-size:13px}
    .accent{color:var(--accent-strong);font-weight:700}
    input[type="date"]{background:var(--input-bg);color:var(--text);border:1px solid var(--input-border);border-radius:10px;padding:8px 10px;outline:none; width: 140px;}
    .btn,.btn2{border:1px solid var(--input-border);border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn{background:var(--btn)} .btn2{background:var(--btn2)}
    .pill{display:inline-block;background:var(--input-bg);border:1px solid var(--input-border);border-radius:999px;padding:6px 10px;font-size:14px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}
    .radio{display:flex;gap:12px;align-items:center;border:1px solid var(--input-border);background:var(--input-bg);border-radius:12px;padding:10px 12px;cursor:pointer}
    .summary-item{margin-bottom: 16px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px;}
    .summary-bottom{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px;padding-top:12px;border-top:1px dashed var(--input-border)}
    .summary-box{background:var(--input-bg);border:1px solid var(--input-border);border-radius:12px;padding:12px;text-align:center}
    .summary-box .value{font-weight:800;font-size:18px}
    .copy-area{background:#333; color:#eee; padding:15px; border-radius:10px; font-family: monospace; white-space: pre-wrap; margin-top: 10px; font-size: 14px;}
    .date-badge{background: var(--accent); color: white; padding: 4px 12px; border-radius: 8px; font-size: 14px; font-weight: bold;}
  </style>
</head>
<body>
  <div class="container">
    <h1>訂房計價 Demo</h1>

    <div class="card">
      <div style="display:flex; gap:15px; align-items:center; flex-wrap:wrap;">
        <div>
          <div class="label">入住日</div>
          <input id="checkIn" type="date">
        </div>
        <div style="font-size: 20px; color: var(--muted); padding-top: 15px;">➜</div>
        <div>
          <div class="label">退房日</div>
          <input id="checkOut" type="date">
        </div>
        <div style="padding-top: 18px;">
          <span id="dateQuickInfo" class="date-badge">0 天 0 夜</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="label">選擇房型</div>
      <div id="roomList" class="grid"></div>
    </div>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div><div class="title">入住貓咪數</div><div class="hint">兩隻以上都視為多貓價</div></div>
        <div>
          <button id="minusCats" class="btn2">－</button>
          <span id="catsText" class="pill">1 隻</span>
          <button id="plusCats" class="btn">＋</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="font-size:18px; border-left:4px solid var(--accent); padding-left:10px;">預定摘要</h2>
      
      <div class="summary-item">
        <div class="label">房型</div>
        <div id="resRoomName" style="font-weight:700;">-</div>
      </div>

      <div class="summary-item">
        <div class="label">貓咪隻數</div>
        <div id="resCats" style="font-weight:700;">1 隻</div>
      </div>

      <div class="summary-item">
        <div class="label">夜數</div>
        <div id="resNights" style="font-weight:700;">-</div>
      </div>

      <div class="summary-item">
        <div class="label">總金額計價</div>
        <div id="resPriceDetail" style="font-weight:700; color:var(--accent-strong); line-height:1.6;">--</div>
      </div>

      <div class="summary-bottom">
        <div class="summary-box"><div class="label">訂金(30%)</div><div id="resDeposit" class="value">NT$ 0</div></div>
        <div class="summary-box"><div class="label">尾款</div><div id="resBalance" class="value">NT$ 0</div></div>
        <div class="summary-box"><div class="label">總價</div><div id="resTotal" class="value">NT$ 0</div></div>
      </div>

      <div style="margin-top:20px;">
        <div class="label">員工專用複製文字</div>
        <div id="copyText" class="copy-area">尚未生成</div>
      </div>
    </div>
  </div>

  <script>
    const ROOMS = [
      { key:"jazz", name:"爵士房", maxCats:2 },
      { key:"upgrade", name:"爵士升等房", maxCats:3 },
      { key:"first", name:"頭等房", maxCats:4 },
      { key:"little_president", name:"小總統房", maxCats:6 },
      { key:"president", name:"大總統房", maxCats:7 },
      { key:"stand", name:"東海標準房", maxCats:2 }
    ];

    const FIXED_SINGLE = {
      jazz: { N06:680, N13:650, N30:550, N90:500 },
      upgrade: { N06:790, N13:750, N30:650, N90:570 },
      first: { N06:1010, N13:960, N30:820, N90:730 },
      little_president: { N06:1800, N13:1700, N30:1600, N90:1400 },
      president: { N06:2300, N13:2150, N30:1850, N90:1650 },
      stand: { N06:720, N13:680, N30:570, N90:520 }
    };

    const FIXED_MULTI = {
      jazz: { N06:860, N13:810, N30:680, N90:620 },
      upgrade: { N06:990, N13:940, N30:800, N90:720 },
      first: { N06:1260, N13:1200, N30:1010, N90:910 },
      little_president: { N06:2250, N13:2100, N30:1800, N90:1600 },
      president: { N06:2880, N13:2700, N30:2300, N90:2100 },
      stand: { N06:900, N13:850, N30:710, N90:650 }
    };

    function pricesFor(key){
      switch(key){
        case "jazz": return { single:760, multi:950 };
        case "upgrade": return { single:880, multi:1100 };
        case "first": return { single:1120, multi:1400 };
        case "little_president": return { single:2000, multi:2500 };
        case "president": return { single:2560, multi:3200 };
        case "stand": return { single:800, multi:1000 };
        default: return { single:0, multi:0 };
      }
    }

    function inCNY(dObj){
      const val = (dObj.getMonth()+1)*100 + dObj.getDate();
      return val >= 214 && val <= 222;
    }

    function getTier(n){
      if (n >= 90) return {code:"N90", label:"90晚起"};
      if (n >= 30) return {code:"N30", label:"30晚起"};
      if (n >= 13) return {code:"N13", label:"13晚起"};
      if (n >= 6) return {code:"N06", label:"6晚起"};
      return null;
    }

    let selectedKey = "stand", cats = 1;

    function recalc(){
      const ciVal = document.getElementById('checkIn').value;
      const coVal = document.getElementById('checkOut').value;
      if(!ciVal || !coVal) return;
      const ci = new Date(ciVal), co = new Date(coVal);
      if(co <= ci) {
        document.getElementById('dateQuickInfo').innerText = "日期錯誤";
        return;
      }

      const nightsList = [];
      let cur = new Date(ci);
      while(cur < co){ nightsList.push(new Date(cur)); cur.setDate(cur.getDate()+1); }
      
      const nTotalNights = nightsList.length;
      document.getElementById('dateQuickInfo').innerText = `${nTotalNights + 1} 天 ${nTotalNights} 夜`;

      const isMulti = (cats >= 2);
      const hDates = nightsList.filter(inCNY);
      const nDates = nightsList.filter(d => !inCNY(d));
      
      let total = 0, detailText = "";
      
      // 1. 過年計價
      let hTotal = 0, hString = "";
      if (selectedKey === "stand" && hDates.length > 0) {
        const hN = hDates.length;
        if (hN === 8) { hTotal = 9888; hString = "9天8夜9888元"; }
        else if (hN >= 4) { hTotal = 6888 + (hN-4)*1250; hString = `過年4晚套裝6888元 + 加購${hN-4}晚${(hN-4)*1250}元`; }
        else { hTotal = hN * 1250; hString = `過年住宿${hN}晚${hTotal}元`; }
      } else {
        const p = pricesFor(selectedKey);
        hTotal = hDates.length * (isMulti ? p.multi : p.single);
        if(hDates.length > 0) hString = `過年期間${hDates.length}晚(${hTotal}元)`;
      }

      // 2. 非過年計價 (判斷長住)
      let nTotal = 0, nString = "";
      const nN = nDates.length;
      if (nN > 0) {
        const tier = getTier(nN);
        const base = pricesFor(selectedKey);
        let unitPrice = isMulti ? base.multi : base.single;
        let tierLabel = "一般價";

        if (tier && FIXED_SINGLE[selectedKey]) {
          unitPrice = isMulti ? FIXED_MULTI[selectedKey][tier.code] : FIXED_SINGLE[selectedKey][tier.code];
          tierLabel = `長住折扣 ${tier.label}`;
        }
        nTotal = nN * unitPrice;
        nString = `非過年住宿${nN}晚(${tierLabel})${nTotal}元`;
      }

      total = hTotal + nTotal;
      detailText = [hString, nString].filter(Boolean).join(" + ") + ` = ${total}元`;

      // 更新介面
      const room = ROOMS.find(r=>r.key===selectedKey);
      document.getElementById('resRoomName').innerText = room.name;
      document.getElementById('resCats').innerText = `${cats} 隻`;
      document.getElementById('resNights').innerText = `${nTotalNights} 夜`;
      document.getElementById('resPriceDetail').innerText = detailText;
      
      const deposit = Math.round(total * 0.3);
      document.getElementById('resDeposit').innerText = `NT$ ${deposit}`;
      document.getElementById('resBalance').innerText = `NT$ ${total - deposit}`;
      document.getElementById('resTotal').innerText = `NT$ ${total}`;

      const d1 = (ci.getMonth()+1) + "/" + ci.getDate();
      const d2 = (co.getMonth()+1) + "/" + co.getDate();
      document.getElementById('copyText').innerText = 
        `${d1}~${d2} 共${nTotalNights}晚\n住宿費用總共${total}元\n訂金${deposit}元\n尾款${total-deposit}元`;
    }

    function renderRooms(){
      const list = document.getElementById('roomList');
      list.innerHTML = '';
      ROOMS.forEach(r=>{
        const div = document.createElement('label');
        div.className = 'radio';
        div.innerHTML = `<input type="radio" name="room" ${selectedKey===r.key?'checked':''}>${r.name}`;
        div.onclick = () => { selectedKey = r.key; recalc(); };
        list.appendChild(div);
      });
    }

    document.getElementById('minusCats').onclick = () => { if(cats>1){cats--; document.getElementById('catsText').innerText=`${cats} 隻`; recalc();} };
    document.getElementById('plusCats').onclick = () => { if(cats<ROOMS.find(r=>r.key===selectedKey).maxCats){cats++; document.getElementById('catsText').innerText=`${cats} 隻`; recalc();} };
    document.getElementById('checkIn').onchange = recalc;
    document.getElementById('checkOut').onchange = recalc;

    const today = new Date();
    const tom = new Date(); tom.setDate(today.getDate()+1);
    document.getElementById('checkIn').value = today.toISOString().split('T')[0];
    document.getElementById('checkOut').value = tom.toISOString().split('T')[0];
    
    renderRooms();
    recalc();
  </script>
</body>
</html>
